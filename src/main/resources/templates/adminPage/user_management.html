<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<!-- 공통 헤드-->
<th:block th:replace="/fragments/head :: headFragment"></th:block>

<!-- CKEditor CDN 추가 -->
<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>

<!-- Custom Stylesheets -->
<link rel="stylesheet" href="css/form/form.css">
<link rel="stylesheet" href="css/layout/sidebar.css">
<style>
    .userManagement {
        border: 1px solid #000000;
        background-color: #ffffff;
        color: #000000;
    }

    .userManagement:hover {
        border: 1px solid #000000;
        background-color: #000000;
        color: #ffffff;
    }

    #insertBtn {
        width: 130px;
    }

    #container {
        width: 1000px;
        margin: 20px auto;
    }

    .dropdown-toggle::before {
        color: #00000000;
    }

    a.dropdown-item:active {
        color: rgb(0, 0, 0);
        background-color: #e6e6e6;
    }

    .col.process {
        height: 680px;
        max-height: 680px;
        overflow-y: auto;
    }

    .col.process::-webkit-scrollbar {
        width: 10px;
    }

    .col.process::-webkit-scrollbar-thumb {
        background-color: #a3a3a3;
        border-radius: 10px;
        background-clip: padding-box;
        border: 2px solid transparent;
    }

    .col.process::-webkit-scrollbar-track {
        background-color: rgb(204, 204, 204);
        border-radius: 10px;
        box-shadow: inset 0px 0px 5px white;
    }

    .feather.feather-clock {
        width: 20px;
        height: 20px;
        position: relative;
        bottom: 1px;
    }

    .selected {
        border: 2px solid rgb(59, 135, 206);
        background-color: rgba(59, 135, 206, 0.1);
        /* 하늘색 반투명 배경 */
        position: relative;
        /* 상대 위치 지정 */
    }

    .selected::after {
        content: "";
        background-image: url('/images/check.svg');
        background-size: cover;
        width: 100px;
        height: 100px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .user_name {
        cursor: pointer;
        display: inline-block;
    }
</style>

<body>
    <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="/admin_home"><img src="/images/dgmark.png" alt="logo"
                style="width: 20%;">
            <p class="home">채용관리시스템</p>
        </a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </header>

    <div class="container-fluid">
        <div class="row">
            <!-- 사이드바 -->
            <th:block th:replace="/fragments/sidebar :: sidebarFragment"></th:block>
            <div class="col-md-9 col-lg-10 px-md-4">
                <div class="row mb-4 border-bottom">
                    <div class="col">
                        <h1 class="h2 my-3">지원자 관리</h1>
                    </div>
                    <div class="col">
                        <div class="btn-toolbar me-2 my-4 mb-md-0 float-end">
                            <button type="button" class="btn btn-sm mx-1 btn-outline-secondary dropdown-toggle ">
                                <span data-feather="calendar"></span>
                                등록순
                            </button>
                            <button type="button" id="processBtn"
                                class="btn btn-sm mx-1 btn-outline-secondary rounded-0">채용단계 이동</button>
                        </div>
                    </div>
                </div>
                <!-- <div class="row">
                    <h5 class="mb-4" th:text="${appTitle}"></h5>
                </div>
                <div class="w-100" id="myChart" width="900" height="380">
                    <div class="row user_container">
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2">지원서 접수</h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step1UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <div class="col">
                                            <h5 class="card-title user_name" th:text="${user.userName}"
                                                th:data-form-no="${user.formNo}"></h5>
                                        </div>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2">서류 심사</h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step2UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <h5 class="card-title user_name" th:text="${user.userName}"
                                            style="cursor: pointer;" th:data-form-no="${user.formNo}"></h5>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2">실무 면접</h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step3UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <h5 class="card-title user_name" th:text="${user.userName}"
                                            style="cursor: pointer;" th:data-form-no="${user.formNo}"></h5>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2">최종 검토</h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step4UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <h5 class="card-title user_name" th:text="${user.userName}"
                                            style="cursor: pointer;" th:data-form-no="${user.formNo}"></h5>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->
                <div class="row">
                    <h5 class="mb-4" th:text="${appTitle}"></h5>
                </div>
                <div class="w-100" id="myChart" width="900" height="380">
                    <div class="row user_container">
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2" th:text="|지원저 접수 (${#lists.size(step1UserList)})|"></h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step1UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <div class="col">
                                            <h5 class="card-title user_name" th:text="${user.userName}"
                                                th:data-form-no="${user.formNo}"></h5>
                                        </div>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2" th:text="|서류 심사 (${#lists.size(step2UserList)})|">서류 심사</h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step2UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <h5 class="card-title user_name" th:text="${user.userName}"
                                            style="cursor: pointer;" th:data-form-no="${user.formNo}"></h5>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2" th:text="|실무 면접(${#lists.size(step3UserList)})|"></h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step3UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <h5 class="card-title user_name" th:text="${user.userName}"
                                            style="cursor: pointer;" th:data-form-no="${user.formNo}"></h5>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col border border-2 border-secondary-subtle rounded-2 px-0 pb-2">
                            <h5 class="border-bottom p-2" th:text="|최종 검토(${#lists.size(step4UserList)})|"></h5>
                            <div class="col process">
                                <div class="card m-1" th:each="user : ${step4UserList}">
                                    <input type="hidden" class="app_no" id="app_no" name="app_no"
                                        th:value="${user.appNo}">
                                    <div class="card-body">
                                        <h5 class="card-title user_name" th:text="${user.userName}"
                                            style="cursor: pointer;" th:data-form-no="${user.formNo}"></h5>
                                        <p class="card-text" th:text="${user.appJob}"></p>
                                        <span data-feather="clock"></span>
                                        <p class="card-text" th:text="${user.appTitle}" style="display: inline-block">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 공통 스크립트-->
    <th:block th:replace="/fragments/script :: scriptFragment"></th:block>
    <script>
        feather.replace()
    </script>
    <script>
        $('.user_name').on('click', function (event) {
            event.stopPropagation();

            var formNo = $(this).data("form-no");
            console.log(formNo);

            var popupW = 1400;
            var popupH = 800;
            var popupX = (window.screen.width - popupW) / 2;
            var popupY = (window.screen.height - popupH) / 2;

            $.ajax({
                method: "POST",
                url: "/user_preview?form_no=" + formNo
            })
                .done(function (data) {
                    window.open('/user_preview?form_no=' + formNo, 'appDetailPopup', 'width=' + popupW + ', height=' + popupH + ', top=' + popupY + ', left=' + popupX);
                })
                .fail(function (data, textStatus, errorThrown) {
                    alert("해당 공고에 등록된 이메일이 있습니다.")
                    callback(data);
                });

        });

        $('.card-body').on('click', function () {
            // 선택한 카드에 selected 클래스를 토글합니다.
            $(this).toggleClass('selected');
        });

        $('#processBtn').on('click', function () {
            var selectedCards = $('.card-body.selected');
            var selectedAppNos = [];
            var selectedFormNos = [];

            var count = 0;
            var total = selectedCards.length;

            selectedCards.each(function () {
                var appNo = $(this).parent().find('.app_no').val();
                var formNo = $(this).find('.user_name').data('form-no');
                selectedAppNos.push(appNo);
                selectedFormNos.push(formNo);

                $.ajax({
                    method: "GET",
                    url: "/user_management?app_no=" + appNo + "&form_no=" + formNo, // URL에 파라미터 추가
                })
                    .done(function (data) {
                        count++;
                        if (count === total) {
                            location.reload();
                        }

                    })
                    .fail(function (data, textStatus, errorThrown) {
                        alert("실패")
                        callback(data);
                    });
            });

            // 선택된 카드가 없을 때 처리
            if (selectedAppNos.length === 0 || selectedFormNos.length === 0) {
                alert("선택된 항목이 없습니다.");
                return;
            }

        });
    </script>
</body>

</html>